# ä»£ç ç»´æŠ¤æ€§å’Œæ¨¡å—åŒ–æ”¹è¿›å»ºè®®

## ä¸‰ã€ç»„ä»¶æ¶æ„é—®é¢˜

### 3.1 Options API å’Œ Composition API æ··ç”¨
**é—®é¢˜ä½ç½®ï¼š** `src/components/common/AvatarName.vue`, `src/App.vue`

**é—®é¢˜æè¿°ï¼š**
- åŒä¸€ç»„ä»¶ä¸­æ··ç”¨ä¸¤ç§ API é£æ ¼
- ä»£ç é£æ ¼ä¸ä¸€è‡´ï¼Œéš¾ä»¥ç»´æŠ¤

**æ”¹è¿›å»ºè®®ï¼š**
ç»Ÿä¸€ä½¿ç”¨ Composition APIï¼ˆVue 3 æ¨èï¼‰ï¼š
```vue
<!-- AvatarName.vue æ”¹è¿›ç¤ºä¾‹ -->
<script setup>
import { ref, onMounted } from 'vue'
import { getCookie } from '@/utils/cookie'
import { globalProfileCacher } from '@/utils/global_img_cache'
import { acquireLock, releaseLock } from '@/utils/lock'
import { openPage } from '@/utils/other'
import { getProfileUrl } from '@/utils/profile'

const props = defineProps({
  initData: {
    type: Object,
    default: () => ({ id: null, name: null })
  },
  size: { type: String, default: '30' },
  color: { type: String, default: '#000' },
  clickable: { type: Boolean, default: true },
  ifShowName: { type: Boolean, default: true },
  nameSize: { type: String, default: '16' }
})

const profileUrl = ref(null)

const toAuthorPage = () => {
  if (!props.clickable) return
  
  const routeName = getCookie("userId") == props.initData.id 
    ? 'SelfPage' 
    : 'AuthorPage'
  
  openPage("router", {
    name: routeName,
    params: { id: props.initData.id }
  })
}

const getProfile = async () => {
  const cacheKey = globalProperties.$apiUrl + '/image/user?user_id=' + props.initData.id
  const cached = globalProfileCacher.getImage(cacheKey)
  
  if (cached) {
    profileUrl.value = cached
    return
  }
  
  profileUrl.value = await getProfileUrl(props.initData.id)
}

onMounted(async () => {
  const lockKey = 'profile-' + props.initData.id
  await acquireLock(lockKey)
  try {
    await getProfile()
  } finally {
    releaseLock(lockKey)
  }
})
</script>
```

### 3.2 Props å‘½åä¸ä¸€è‡´
**é—®é¢˜æè¿°ï¼š**
- æœ‰äº›ç»„ä»¶ç”¨ `initData`ï¼Œæœ‰äº›ç”¨ `data`
- ç¼ºå°‘ç»Ÿä¸€çš„å‘½åè§„èŒƒ

**æ”¹è¿›å»ºè®®ï¼š**
- ç»Ÿä¸€ä½¿ç”¨ `initData` ä½œä¸ºåˆå§‹æ•°æ® prop
- ç»„ä»¶å†…éƒ¨ä½¿ç”¨ `data` ä½œä¸ºå“åº”å¼æ•°æ®
- åˆ›å»ºç»„ä»¶å¼€å‘è§„èŒƒæ–‡æ¡£

### 3.3 ç»„ä»¶èŒè´£ä¸æ¸…
**é—®é¢˜ä½ç½®ï¼š** `src/App.vue` (450+ è¡Œ)

**é—®é¢˜æè¿°ï¼š**
- App.vue æ‰¿æ‹…äº†å¤ªå¤šèŒè´£ï¼ˆå¯¼èˆªã€æœç´¢ã€å¯¹è¯æ¡†ç®¡ç†ç­‰ï¼‰
- åº”è¯¥æ‹†åˆ†ä¸ºæ›´å°çš„ç»„ä»¶

**æ”¹è¿›å»ºè®®ï¼š**
```
src/components/layout/
  â”œâ”€â”€ AppNavBar.vue        # å¯¼èˆªæ 
  â”œâ”€â”€ AppSearchBar.vue     # æœç´¢æ 
  â”œâ”€â”€ AppBottomNav.vue     # åº•éƒ¨å¯¼èˆª
  â””â”€â”€ AppDialog.vue        # å¯¹è¯æ¡†å®¹å™¨
```

---


### 4.2 é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€
**é—®é¢˜æè¿°ï¼š**
- è™½ç„¶å®šä¹‰äº† `dealAxiosError`ï¼Œä½†å„ API æ–‡ä»¶ä½¿ç”¨æ–¹å¼ä¸ä¸€è‡´
- ç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶

**æ”¹è¿›å»ºè®®ï¼š**
```javascript
// src/axios/interceptors.js
export function setupResponseInterceptor(axiosInstance) {
  axiosInstance.interceptors.response.use(
    response => response,
    async error => {
      const handledError = await dealAxiosError(error)
      // ç»Ÿä¸€å¤„ç†é”™è¯¯
      return Promise.reject(handledError)
    }
  )
}
```

### 4.3 API æ–‡ä»¶ç»„ç»‡
**æ”¹è¿›å»ºè®®ï¼š**
```
src/api/  (é‡å‘½å axios ç›®å½•ä¸º apiï¼Œæ›´è¯­ä¹‰åŒ–)
  â”œâ”€â”€ index.js           # å¯¼å‡ºæ‰€æœ‰ API
  â”œâ”€â”€ request.js         # axios å®ä¾‹é…ç½®
  â”œâ”€â”€ modules/
  â”‚   â”œâ”€â”€ article.js
  â”‚   â”œâ”€â”€ account.js
  â”‚   â””â”€â”€ ...
  â””â”€â”€ types/            # API ç±»å‹å®šä¹‰ï¼ˆå¦‚æœä½¿ç”¨ TypeScriptï¼‰
```

---

## äº”ã€çŠ¶æ€ç®¡ç†é—®é¢˜

### 5.1 Store è¿‡äºç®€å•
**é—®é¢˜ä½ç½®ï¼š** `src/store/index.js`

**é—®é¢˜æè¿°ï¼š**
- åªæœ‰åŸºæœ¬çš„ç”¨æˆ·çŠ¶æ€
- ç¼ºå°‘æ¨¡å—åŒ–ç»„ç»‡

**æ”¹è¿›å»ºè®®ï¼š**
```javascript
// src/store/modules/user.js
export default {
  namespaced: true,
  state: () => ({
    user: null,
    cookie: null,
  }),
  getters: {
    isLoggedIn: (state) => !!state.cookie,
  },
  mutations: {
    SET_USER(state, user) {
      state.user = user
    },
    // ...
  },
  actions: {
    // ...
  }
}

// src/store/index.js
import { createStore } from 'vuex'
import user from './modules/user'
import editor from './modules/editor'

export default createStore({
  modules: {
    user,
    editor,
  }
})
```

---

## å…­ã€è·¯ç”±ç®¡ç†é—®é¢˜

### 6.1 è·¯ç”±å®ˆå«é€»è¾‘å¤æ‚
**é—®é¢˜ä½ç½®ï¼š** `src/router/index.js`

**é—®é¢˜æè¿°ï¼š**
- beforeEach ä¸­é€»è¾‘è¿‡å¤š
- è°ƒè¯•è·¯ç”±å¤„ç†é€»è¾‘å¤æ‚

**æ”¹è¿›å»ºè®®ï¼š**
```javascript
// src/router/guards/auth.js
export function setupAuthGuard(router) {
  router.beforeEach((to, from, next) => {
    if (to.matched.some(record => record.meta.requiresAuth)) {
      // è®¤è¯é€»è¾‘
      next()
    } else {
      next()
    }
  })
}

// src/router/guards/debug.js
export function setupDebugGuard(router) {
  router.beforeEach((to, from, next) => {
    if (to.name.endsWith("Debug") && (!from.name || !from.name.endsWith("Debug"))) {
      startDebug()
      window.alert("æœ¬é¡µé¢å¤„äºè°ƒè¯•æ¨¡å¼")
    }
    next()
  })
}

// src/router/index.js
import { setupAuthGuard } from './guards/auth'
import { setupDebugGuard } from './guards/debug'

const router = createRouter({ ... })
setupAuthGuard(router)
setupDebugGuard(router)
```

### 6.2 è·¯ç”±é…ç½®ç»„ç»‡
**æ”¹è¿›å»ºè®®ï¼š**
```
src/router/
  â”œâ”€â”€ index.js           # ä¸»è·¯ç”±é…ç½®
  â”œâ”€â”€ routes.js          # è·¯ç”±å®šä¹‰
  â”œâ”€â”€ guards/
  â”‚   â”œâ”€â”€ auth.js
  â”‚   â”œâ”€â”€ debug.js
  â”‚   â””â”€â”€ history.js
  â””â”€â”€ meta.js            # è·¯ç”±å…ƒä¿¡æ¯
```

---

## ä¸ƒã€ç±»å‹å®‰å…¨

### 7.1 ç¼ºå°‘ç±»å‹æ£€æŸ¥
**é—®é¢˜æè¿°ï¼š**
- é¡¹ç›®ä½¿ç”¨ JavaScriptï¼Œç¼ºå°‘ç±»å‹æ£€æŸ¥
- Props å®šä¹‰ä¸å¤Ÿä¸¥æ ¼

**æ”¹è¿›å»ºè®®ï¼š**
- è€ƒè™‘è¿ç§»åˆ° TypeScript
- æˆ–è€…ä½¿ç”¨ JSDoc æ³¨é‡Šå¢å¼ºç±»å‹æç¤ºï¼š
```javascript
/**
 * @typedef {Object} ArticleData
 * @property {string} id
 * @property {string} title
 * @property {string} content
 */

/**
 * @param {ArticleData} article
 * @returns {Promise<ArticleData>}
 */
export async function processArticle(article) {
  // ...
}
```

---

## å…«ã€ä»£ç è´¨é‡

### 8.1 ç¼ºå°‘ä»£ç è§„èŒƒ
**æ”¹è¿›å»ºè®®ï¼š**
- ä½¿ç”¨ ESLint + Prettier ç»Ÿä¸€ä»£ç é£æ ¼
- æ·»åŠ  pre-commit hooksï¼ˆhusky + lint-stagedï¼‰
- é…ç½® `.editorconfig`

### 8.2 æ³¨é‡Šå’Œæ–‡æ¡£
**æ”¹è¿›å»ºè®®ï¼š**
- ä¸ºå¤æ‚å‡½æ•°æ·»åŠ  JSDoc æ³¨é‡Š
- åˆ›å»ºç»„ä»¶ä½¿ç”¨æ–‡æ¡£
- æ·»åŠ  API ä½¿ç”¨ç¤ºä¾‹

### 8.3 æµ‹è¯•è¦†ç›–
**æ”¹è¿›å»ºè®®ï¼š**
- æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆJest + Vue Test Utilsï¼‰
- æ·»åŠ  E2E æµ‹è¯•ï¼ˆCypress æˆ– Playwrightï¼‰
- å…³é”®ä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 ç»„ä»¶æ‡’åŠ è½½
**æ”¹è¿›å»ºè®®ï¼š**
- è·¯ç”±ç»„ä»¶å·²ä½¿ç”¨æ‡’åŠ è½½ï¼Œä½†å¯ä»¥ä¼˜åŒ–
- å¤§å‹ç»„ä»¶ä½¿ç”¨ `defineAsyncComponent`

---

## åã€ç›®å½•ç»“æ„ä¼˜åŒ–

### 10.1 å»ºè®®çš„æ–°ç›®å½•ç»“æ„
```
src/
  â”œâ”€â”€ api/              # API è°ƒç”¨ï¼ˆé‡å‘½åè‡ª axiosï¼‰
  â”‚   â”œâ”€â”€ modules/
  â”‚   â””â”€â”€ request.js
  â”œâ”€â”€ assets/           # é™æ€èµ„æº
  â”œâ”€â”€ components/       # ç»„ä»¶
  â”‚   â”œâ”€â”€ common/       # é€šç”¨ç»„ä»¶
  â”‚   â”œâ”€â”€ layout/       # å¸ƒå±€ç»„ä»¶
  â”‚   â””â”€â”€ [feature]/    # åŠŸèƒ½ç»„ä»¶
  â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
  â”œâ”€â”€ composables/      # ç»„åˆå¼å‡½æ•°ï¼ˆæ–°å¢ï¼‰
  â”œâ”€â”€ constants/        # å¸¸é‡å®šä¹‰ï¼ˆæ–°å¢ï¼‰
  â”œâ”€â”€ pages/            # é¡µé¢
  â”œâ”€â”€ router/           # è·¯ç”±
  â”œâ”€â”€ store/            # çŠ¶æ€ç®¡ç†
  â”‚   â””â”€â”€ modules/      # Store æ¨¡å—
  â”œâ”€â”€ styles/           # æ ·å¼æ–‡ä»¶ï¼ˆé‡å‘½åè‡ª styleï¼‰
  â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰ï¼ˆå¦‚æœä½¿ç”¨ TSï¼‰
  â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
      â””â”€â”€ [category]/   # æŒ‰ç±»åˆ«ç»„ç»‡
```

---

## åä¸€ã€å…·ä½“æ”¹è¿›ä¼˜å…ˆçº§



### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸæ”¹è¿›ï¼‰
1. âš ï¸ ç»„ä»¶é‡æ„ï¼šç»Ÿä¸€ä½¿ç”¨ Composition API
3. âš ï¸ Store æ¨¡å—åŒ–ï¼šæ‹†åˆ†çŠ¶æ€ç®¡ç†æ¨¡å—
4. âš ï¸ ä»£ç è§„èŒƒï¼šæ·»åŠ  ESLint/Prettier é…ç½®

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰
1. ğŸ“‹ TypeScript è¿ç§»
2. ğŸ“‹ æµ‹è¯•è¦†ç›–
3. ğŸ“‹ æ€§èƒ½ä¼˜åŒ–
4. ğŸ“‹ æ–‡æ¡£å®Œå–„

---

## åäºŒã€å®æ–½å»ºè®®

1. **æ¸è¿›å¼é‡æ„**ï¼šä¸è¦ä¸€æ¬¡æ€§é‡æ„æ‰€æœ‰ä»£ç ï¼ŒæŒ‰æ¨¡å—é€æ­¥æ”¹è¿›
2. **ä¿æŒå‘åå…¼å®¹**ï¼šé‡æ„æ—¶ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
3. **ä»£ç å®¡æŸ¥**ï¼šå»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶ï¼Œç¡®ä¿æ–°ä»£ç ç¬¦åˆè§„èŒƒ
4. **æ–‡æ¡£å…ˆè¡Œ**ï¼šåœ¨é‡æ„å‰å…ˆå®Œå–„ç›¸å…³æ–‡æ¡£
5. **æµ‹è¯•ä¿éšœ**ï¼šé‡æ„ååŠæ—¶æ·»åŠ æµ‹è¯•ï¼Œé˜²æ­¢å›å½’

---

## æ€»ç»“

ä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š
- é…ç½®ç®¡ç†æ··ä¹±
- å·¥å…·å‡½æ•°ç»„ç»‡ä¸å½“
- ç»„ä»¶æ¶æ„ä¸ç»Ÿä¸€
- ç¼ºå°‘ç±»å‹å®‰å…¨
- ä»£ç è§„èŒƒä¸å®Œå–„

å»ºè®®æŒ‰ç…§ä¼˜å…ˆçº§é€æ­¥æ”¹è¿›ï¼Œé‡ç‚¹å…³æ³¨é…ç½®ç®¡ç†å’Œä»£ç ç»„ç»‡ï¼Œè¿™å°†æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚


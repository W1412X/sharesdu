# 测试配置总结

## 概述

已为项目配置完整的测试框架，包括单元测试（Jest + Vue Test Utils）和 E2E 测试（Cypress）。

## 已完成的配置

### 1. 单元测试配置（Jest）

#### 配置文件
- `jest.config.js` - Jest 主配置文件
- `tests/setup.js` - 测试环境设置文件

#### 主要特性
- ✅ 支持 Vue 3 组件测试
- ✅ 支持 ES6+ 语法转换
- ✅ 路径别名支持（`@/`）
- ✅ Vuetify 组件支持
- ✅ 代码覆盖率收集

#### 测试脚本
```bash
npm run test:unit          # 运行所有单元测试
npm run test:unit:watch    # 监听模式运行
npm run test:unit:coverage # 生成覆盖率报告
```

### 2. E2E 测试配置（Cypress）

#### 配置文件
- `cypress.config.js` - Cypress 主配置文件
- `tests/e2e/support/e2e.js` - Cypress 支持文件

#### 主要特性
- ✅ 支持 E2E 和组件测试
- ✅ 自定义命令支持
- ✅ 测试数据管理（fixtures）
- ✅ 截图和视频录制

#### 测试脚本
```bash
npm run test:e2e       # 运行 E2E 测试（无头模式）
npm run test:e2e:open # 打开 Cypress 测试界面
```

### 3. 已创建的测试文件

#### 单元测试
1. **工具函数测试**
   - `tests/unit/utils/color.spec.js` - 颜色工具函数测试
   - `tests/unit/utils/cookie.spec.js` - Cookie 工具函数测试
   - `tests/unit/utils/auth.spec.js` - 认证工具函数测试
   - `tests/unit/utils/imageUtils.spec.js` - 图片工具函数测试

2. **组件测试**
   - `tests/unit/components/AvatarName.spec.js` - AvatarName 组件测试

3. **API 模块测试**
   - `tests/unit/api/request.spec.js` - API 请求模块测试

4. **Store 测试**
   - `tests/unit/store/index.spec.js` - Vuex Store 测试

#### E2E 测试
1. **登录流程测试**
   - `tests/e2e/login.cy.js` - 登录功能 E2E 测试

2. **搜索功能测试**
   - `tests/e2e/search.cy.js` - 搜索功能 E2E 测试

### 4. 测试数据
- `tests/e2e/fixtures/example.json` - 测试数据示例

## 安装依赖

运行以下命令安装测试依赖：

```bash
npm install --save-dev @vue/test-utils @vue/vue3-jest babel-jest jest jest-environment-jsdom cypress
```

## 测试覆盖率目标

- **工具函数**: > 80%
- **关键业务逻辑**: > 70%
- **组件**: > 60%
- **API 模块**: > 70%

## 关键业务逻辑测试覆盖

### ✅ 已覆盖
- 颜色工具函数（`utils/color.js`）
- Cookie 工具函数（`utils/cookie.js`）
- 认证工具函数（`utils/auth.js`）
- 图片工具函数（`utils/imageUtils.js`）
- AvatarName 组件
- API 请求模块
- Vuex Store

### ⏳ 待覆盖（建议优先级）

#### 高优先级
1. **路由守卫** (`src/router/index.js`)
   - 认证检查
   - 权限验证
   - 路由重定向

2. **表单验证** (`src/utils/rules.js`)
   - 用户名验证
   - 密码验证
   - 邮箱验证

3. **敏感词过滤** (`src/utils/sensitive.js`)
   - 敏感词检测
   - 内容过滤

#### 中优先级
4. **图片处理** (`src/utils/imageUtils.js`)
   - 图片压缩
   - 图片格式转换
   - 错误处理

5. **数据转换** (`src/utils/common.js`)
   - 响应数据转换
   - 数据格式化

6. **导航工具** (`src/utils/navigation.js`)
   - 页面跳转
   - URL 处理

#### 低优先级
7. **其他工具函数**
   - 格式化函数
   - DOM 操作
   - 字符串处理

## 测试最佳实践

### 单元测试
1. **测试命名**
   - 使用描述性的测试名称
   - 遵循 "应该..." 的格式

2. **测试结构**
   ```javascript
   describe('模块名', () => {
     describe('函数名', () => {
       test('应该...', () => {
         // 测试代码
       });
     });
   });
   ```

3. **Mock 策略**
   - Mock 外部依赖（API、localStorage等）
   - 使用 Jest mock 函数
   - 避免测试依赖真实网络请求

### E2E 测试
1. **测试流程**
   - 测试完整的用户流程
   - 使用 data-cy 属性定位元素
   - 避免硬编码等待时间

2. **API 拦截**
   - 使用 `cy.intercept()` 拦截 API 请求
   - 模拟不同的响应场景

3. **测试数据**
   - 使用 fixtures 管理测试数据
   - 清理测试数据

## 持续集成建议

### GitHub Actions 示例
```yaml
name: Tests
on: [push, pull_request]
jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm install
      - run: npm run test:unit:coverage
      
  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm install
      - run: npm run serve &
      - run: npm run test:e2e
```

## 注意事项

1. **环境变量**
   - 测试环境可能需要不同的配置
   - 使用 `.env.test` 文件管理测试环境变量

2. **异步测试**
   - 正确处理异步操作
   - 使用 `async/await` 或 `done` 回调

3. **测试隔离**
   - 每个测试应该独立
   - 使用 `beforeEach`/`afterEach` 清理状态

4. **性能**
   - 单元测试应该快速运行（< 1秒）
   - E2E 测试可以较慢，但应该优化

## 下一步

1. **安装依赖**
   ```bash
   npm install
   ```

2. **运行测试**
   ```bash
   npm run test:unit
   ```

3. **查看覆盖率**
   ```bash
   npm run test:unit:coverage
   ```

4. **扩展测试**
   - 根据业务需求添加更多测试
   - 提高测试覆盖率
   - 添加集成测试

## 参考文档

- [Jest 文档](https://jestjs.io/)
- [Vue Test Utils 文档](https://test-utils.vuejs.org/)
- [Cypress 文档](https://docs.cypress.io/)
- [Vue 3 测试指南](https://vuejs.org/guide/scaling-up/testing.html)

